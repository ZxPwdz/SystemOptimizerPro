<Window x:Class="SystemOptimizerPro.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SystemOptimizerPro"
        xmlns:views="clr-namespace:SystemOptimizerPro.Views"
        xmlns:vm="clr-namespace:SystemOptimizerPro.ViewModels"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        mc:Ignorable="d"
        Title="System Optimizer Pro"
        Height="720" Width="1100"
        MinHeight="600" MinWidth="900"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResizeWithGrip"
        StateChanged="Window_StateChanged">

    <Window.Resources>
        <DataTemplate DataType="{x:Type vm:DashboardViewModel}">
            <views:DashboardView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:MemoryCleanerViewModel}">
            <views:MemoryCleanerView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:ProcessesViewModel}">
            <views:ProcessesView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:CleaningToolsViewModel}">
            <views:CleaningToolsView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:SettingsViewModel}">
            <views:SettingsView/>
        </DataTemplate>
        <!-- System Tray Icon -->
        <tb:TaskbarIcon x:Key="TrayIconResource"
                        IconSource="/Assets/Icons/app.ico"
                        ToolTipText="System Optimizer Pro"
                        TrayMouseDoubleClick="TrayIcon_TrayMouseDoubleClick"
                        Visibility="Visible">
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Show" Click="ShowMenuItem_Click"/>
                    <MenuItem Header="Quick Optimize" Command="{Binding QuickOptimizeCommand}"/>
                    <Separator/>
                    <MenuItem Header="Exit" Click="ExitMenuItem_Click"/>
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>
    </Window.Resources>

    <!-- Main Container with Shadow -->
    <Border Background="{StaticResource BackgroundPrimaryBrush}"
            CornerRadius="12"
            Margin="10">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20"
                              ShadowDepth="0"
                              Opacity="0.3"
                              Color="#000000"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>   <!-- Title Bar -->
                <RowDefinition Height="*"/>    <!-- Content -->
                <RowDefinition Height="32"/>   <!-- Status Bar -->
            </Grid.RowDefinitions>

            <!-- Custom Title Bar -->
            <Border Grid.Row="0"
                    Background="{StaticResource BackgroundPrimaryBrush}"
                    CornerRadius="12,12,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- App Icon & Title -->
                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                Margin="16,0,0,0"
                                VerticalAlignment="Center">
                        <Ellipse Width="24" Height="24"
                                 Fill="{StaticResource AccentGradientBrush}"
                                 Margin="0,0,10,0"/>
                        <TextBlock Text="System Optimizer Pro"
                                   Style="{StaticResource SubheadingStyle}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Window Controls -->
                    <StackPanel Grid.Column="2"
                                Orientation="Horizontal"
                                Margin="0,0,8,0">
                        <Button x:Name="MinimizeButton"
                                Style="{StaticResource WindowControlButton}"
                                Click="MinimizeButton_Click"
                                ToolTip="Minimize to Tray">
                            <TextBlock Text="&#xE949;" FontFamily="Segoe MDL2 Assets" FontSize="10"/>
                        </Button>
                        <Button x:Name="MaximizeButton"
                                Style="{StaticResource WindowControlButton}"
                                Click="MaximizeButton_Click"
                                ToolTip="Maximize">
                            <TextBlock x:Name="MaximizeIcon" Text="&#xE922;" FontFamily="Segoe MDL2 Assets" FontSize="10"/>
                        </Button>
                        <Button x:Name="CloseButton"
                                Style="{StaticResource WindowCloseButton}"
                                Click="CloseButton_Click"
                                ToolTip="Close">
                            <TextBlock Text="&#xE8BB;" FontFamily="Segoe MDL2 Assets" FontSize="10"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main Content Area -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="220"/>  <!-- Sidebar -->
                    <ColumnDefinition Width="*"/>    <!-- Content -->
                </Grid.ColumnDefinitions>

                <!-- Sidebar Navigation -->
                <Border Grid.Column="0"
                        Background="{StaticResource SidebarBackgroundBrush}"
                        BorderBrush="{StaticResource BorderLightBrush}"
                        BorderThickness="0,0,1,0">

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Quick Optimize Button -->
                        <Button Grid.Row="0"
                                x:Name="QuickOptimizeButton"
                                Style="{StaticResource PrimaryActionButton}"
                                Margin="16,16,16,24"
                                Height="48"
                                Command="{Binding QuickOptimizeCommand}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE945;" FontFamily="Segoe MDL2 Assets" FontSize="18" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="Quick Optimize"
                                           FontWeight="SemiBold"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <!-- Navigation Items -->
                        <StackPanel Grid.Row="1" Margin="8,0">
                            <RadioButton Style="{StaticResource NavItemStyle}"
                                         Content="Dashboard"
                                         IsChecked="True"
                                         Command="{Binding NavigateCommand}"
                                         CommandParameter="Dashboard"/>

                            <RadioButton Style="{StaticResource NavItemStyle}"
                                         Content="Memory Cleaner"
                                         Command="{Binding NavigateCommand}"
                                         CommandParameter="Memory"/>

                            <RadioButton Style="{StaticResource NavItemStyle}"
                                         Content="Processes"
                                         Command="{Binding NavigateCommand}"
                                         CommandParameter="Processes"/>

                            <RadioButton Style="{StaticResource NavItemStyle}"
                                         Content="Cleaning Tools"
                                         Command="{Binding NavigateCommand}"
                                         CommandParameter="Cleaning"/>

                            <Separator Margin="8,16"
                                        Background="{StaticResource BorderLightBrush}"/>

                            <RadioButton Style="{StaticResource NavItemStyle}"
                                         Content="Settings"
                                         Command="{Binding NavigateCommand}"
                                         CommandParameter="Settings"/>
                        </StackPanel>

                        <!-- Version Info -->
                        <TextBlock Grid.Row="2"
                                   Text="v1.1.0"
                                   Style="{StaticResource CaptionStyle}"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,16"/>
                    </Grid>
                </Border>

                <!-- Dynamic Content -->
                <ContentControl Grid.Column="1"
                                Content="{Binding CurrentView}"
                                Margin="0"/>
            </Grid>

            <!-- Status Bar -->
            <Border Grid.Row="2"
                    Background="{StaticResource BackgroundSecondaryBrush}"
                    CornerRadius="0,0,12,12"
                    BorderBrush="{StaticResource BorderLightBrush}"
                    BorderThickness="0,1,0,0">
                <Grid Margin="16,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="{Binding StatusMessage}"
                               Style="{StaticResource CaptionStyle}"
                               VerticalAlignment="Center"/>

                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal"
                                Margin="24,0">
                        <TextBlock Text="RAM: "
                                   Style="{StaticResource CaptionStyle}"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding RamUsagePercent, StringFormat={}{0}%}"
                                   Foreground="{Binding RamUsageColor}"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2"
                                Orientation="Horizontal"
                                Margin="24,0">
                        <TextBlock Text="CPU: "
                                   Style="{StaticResource CaptionStyle}"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding CpuUsagePercent, StringFormat={}{0}%}"
                                   Foreground="{Binding CpuUsageColor}"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <StackPanel Grid.Column="3"
                                Orientation="Horizontal">
                        <Ellipse Width="8" Height="8"
                                 Fill="{Binding MonitoringStatusColor}"
                                 Margin="0,0,6,0"/>
                        <TextBlock Text="{Binding MonitoringStatus}"
                                   Style="{StaticResource CaptionStyle}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
