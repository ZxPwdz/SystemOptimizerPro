<UserControl x:Class="SystemOptimizerPro.Views.ProcessesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0"
                       Text="Processes"
                       Style="{StaticResource HeadingStyle}"/>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <TextBlock Text="{Binding ProcessCount}"
                           Style="{StaticResource SubheadingStyle}"
                           VerticalAlignment="Center"/>
                <TextBlock Text=" processes | "
                           Style="{StaticResource CaptionStyle}"
                           VerticalAlignment="Center"/>
                <TextBlock Text="{Binding TotalMemoryUsage}"
                           Style="{StaticResource CaptionStyle}"
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- Toolbar -->
        <Border Grid.Row="1"
                Style="{StaticResource CardStyle}"
                Padding="12"
                Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Tag="Search processes..."
                         MaxWidth="300"
                         HorizontalAlignment="Left"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Style="{StaticResource SecondaryButton}"
                            Command="{Binding RefreshProcessesCommand}"
                            IsEnabled="{Binding IsRefreshing, Converter={StaticResource InverseBoolConverter}}"
                            Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE72C;" FontFamily="Segoe MDL2 Assets" FontSize="14" Margin="0,0,8,0"/>
                            <TextBlock Text="Refresh"/>
                        </StackPanel>
                    </Button>

                    <Button Style="{StaticResource DangerButton}"
                            Command="{Binding EndProcessCommand}"
                            IsEnabled="{Binding SelectedProcess, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE711;" FontFamily="Segoe MDL2 Assets" FontSize="14" Margin="0,0,8,0"/>
                            <TextBlock Text="End Process"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Process List -->
        <Border Grid.Row="2" Style="{StaticResource CardStyle}" Padding="0">
            <DataGrid ItemsSource="{Binding Processes}"
                      SelectedItem="{Binding SelectedProcess}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column">

                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Background" Value="{Binding IsDangerous, Converter={StaticResource DangerousProcessConverter}}"/>
                        <Setter Property="ToolTip">
                            <Setter.Value>
                                <TextBlock>
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value=""/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsDangerous}" Value="True">
                                                    <Setter Property="Text" Value="System process - Do NOT terminate!"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#301A73E8"/>
                            </Trigger>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding IsMouseOver, RelativeSource={RelativeSource Self}}" Value="True"/>
                                    <Condition Binding="{Binding IsDangerous}" Value="False"/>
                                </MultiDataTrigger.Conditions>
                                <Setter Property="Background" Value="#08000000"/>
                            </MultiDataTrigger>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding IsMouseOver, RelativeSource={RelativeSource Self}}" Value="True"/>
                                    <Condition Binding="{Binding IsDangerous}" Value="True"/>
                                </MultiDataTrigger.Conditions>
                                <Setter Property="Background" Value="#50DC3545"/>
                            </MultiDataTrigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>

                <DataGrid.Columns>
                    <DataGridTextColumn Header="Name"
                                        Binding="{Binding Name}"
                                        Width="200">
                        <DataGridTextColumn.HeaderStyle>
                            <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                                <Setter Property="Tag" Value="Name"/>
                            </Style>
                        </DataGridTextColumn.HeaderStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="PID"
                                        Binding="{Binding Id}"
                                        Width="80"/>

                    <DataGridTextColumn Header="CPU %"
                                        Binding="{Binding CpuUsage, StringFormat={}{0:F1}}"
                                        Width="80"/>

                    <DataGridTextColumn Header="Memory"
                                        Binding="{Binding MemoryFormatted}"
                                        Width="100"/>

                    <DataGridTextColumn Header="Threads"
                                        Binding="{Binding ThreadCount}"
                                        Width="80"/>

                    <DataGridTextColumn Header="Status"
                                        Binding="{Binding Status}"
                                        Width="100"/>
                </DataGrid.Columns>

                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="End Process"
                                  Command="{Binding EndProcessCommand}"/>
                        <MenuItem Header="End Process Tree"
                                  Command="{Binding EndProcessTreeCommand}"/>
                        <Separator/>
                        <MenuItem Header="Open File Location"
                                  Command="{Binding OpenFileLocationCommand}"/>
                    </ContextMenu>
                </DataGrid.ContextMenu>
            </DataGrid>
        </Border>

        <!-- Status Bar -->
        <TextBlock Grid.Row="3"
                   Text="{Binding StatusMessage}"
                   Style="{StaticResource CaptionStyle}"
                   Margin="0,12,0,0"/>
    </Grid>
</UserControl>
